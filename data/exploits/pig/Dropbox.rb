require 'pp'

class PigDropbox < PigParser

	def register_rules
		self.rules = {
			:eth => { :dst_mac => "ff:ff:ff:ff:ff:ff" },
			:udp => { :src_port => 17500, :dst_port => 17500},
		}
	end

	def parse(pkt)
		eth = pkt[:eth]
		ip = pkt[:ip]
		
		return if not ip or not eth
						

		udp = Racket::L4::UDP.new(ip.payload)
		return if not udp

		payload = udp.payload
		return if not payload

		msg = {}
        dropbox = JSON.parse(payload )
		print_status("Dropbox Host: #{ip.src_ip}")
		report_note( :host  => ip.src_ip,
                	:type  => "passive.dropbox",
                	:port => 17500,
                	:proto => "udp",
                	:data => dropbox)

								
	end # end of parse
end

